<div class="content">
    <div class="container-fluid">
        <h4 class="page-title">Inventory</h4>
        <div class="row">
            <div class="col-md-3">
                <div class="card card-stats">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-5">
                                <div class="icon-big text-center">
                                    <i class="fa fa-cloud"></i>
                                </div>
                            </div>
                            <div class="col-7 d-flex align-items-center">
                                <div class="numbers">
                                    <p class="card-category">Cloud Accounts</p>
                                    <h4 class="card-title">
                                        {{ getCloudAccounts() }}
                                    </h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card card-stats">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-5">
                                <div class="icon-big text-center">
                                    <i class="fa fa-globe"></i>
                                </div>
                            </div>
                            <div class="col-7 d-flex align-items-center">
                                <div class="numbers">
                                    <p class="card-category">Regions</p>
                                    <h4 class="card-title">
                                        {{ regions.size }}
                                    </h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card card-stats">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-5">
                                <div class="icon-big text-center">
                                    <i class="fa fa-th"></i>
                                </div>
                            </div>
                            <div class="col-7 d-flex align-items-center">
                                <div class="numbers">
                                    <p class="card-category">Services</p>
                                    <h4 class="card-title">4</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card card-stats">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-5">
                                <div class="icon-big text-center">
                                    <i class="fa fa-th"></i>
                                </div>
                            </div>
                            <div class="col-7 d-flex align-items-center">
                                <div class="numbers">
                                    <p class="card-category">Resources</p>
                                    <h4 class="card-title">
                                        {{ services.length }}
                                    </h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <div class="float-right">
                    <button
                        class="btn btn-primary pull-right mb-2"
                        (click)="openModal(filters)"
                    >
                        <span *ngIf="tags.length > 0 && tags[0].key !== ''"
                            >+</span
                        >
                        Filters
                    </button>
                    <button
                        class="btn btn-info pull-right mr-2"
                        *ngIf="tags.length > 0 && tags[0].key !== ''"
                        (click)="openModal(views)"
                    >
                        Save view
                    </button>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="card">
                    <i *ngIf="!term" class="la la-search search-icon"></i>
                    <i
                        *ngIf="term"
                        class="la la-times search-icon clickable"
                        (click)="cleanSelection()"
                    ></i>
                    <input
                        type="text"
                        class="new-input border-bottom"
                        placeholder="Search by tags, service, name, region..."
                        type="text"
                        data-form-type="”other”"
                        autocomplete="off"
                        [(ngModel)]="term"
                        (ngModelChange)="changeSearchFilter($event)"
                    />
                    <table class="table table-hover">
                        <thead>
                            <th>Provider</th>
                            <th>Account</th>
                            <th>Region</th>
                            <th>Service</th>
                            <th style="width: 15%">Name</th>
                            <th style="width: 15%">Tags</th>
                        </thead>
                        <tbody>
                            <tr *ngFor="let service of selectedResources">
                                <td>
                                    <img
                                        src="assets/img/aws.png"
                                        style="width: 25px"
                                        *ngIf="service.provider === 'AWS'"
                                    />
                                    <img
                                        src="assets/img/digitalocean.png"
                                        style="width: 25px"
                                        *ngIf="
                                            service.provider === 'DIGITALOCEAN'
                                        "
                                    />
                                    <img
                                        src="assets/img/gcp.png"
                                        style="width: 25px"
                                        *ngIf="service.provider === 'GCP'"
                                    />
                                </td>
                                <td>{{ service.account }}</td>
                                <td>{{ service.region }}</td>
                                <td>
                                    <badge
                                        class="badge badge-secondary"
                                        [style.background-color]="
                                            stringToColour(service.service)
                                        "
                                        >{{ service.service }}</badge
                                    >
                                </td>
                                <td>{{ service.name }}</td>
                                <td>{{ service.tags }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<ng-template #filters>
    <div class="modal-body">
        <div class="form-group">
            <label>Filter by tags:</label>
            <div
                class="row col-lg-12 mt-2"
                *ngFor="let tag of tags; let index = index"
            >
                <input
                    type="text"
                    class="form-control col-lg-5 mr-1"
                    placeholder="Key"
                    [(ngModel)]="tags[index].key"
                />
                <input
                    type="text"
                    class="form-control col-lg-5"
                    placeholder="Value"
                    [(ngModel)]="tags[index].value"
                />
                <div class="ml-2" *ngIf="index > 0">
                    <badge class="badge badge-danger" (click)="deleteTag(index)"
                        >Delete</badge
                    >
                </div>
            </div>
            <button class="btn btn-info btn-sm mt-2" (click)="addTags()">
                + add a filter
            </button>
        </div>
        <button class="btn btn-primary pull-right" (click)="applyFilters()">
            Apply filters
        </button>
        <button
            class="btn btn-danger pull-right mr-2"
            (click)="cleanFilters()"
            *ngIf="tags.length > 0 && tags[0].key !== ''"
        >
            Clean filters
        </button>
    </div>
</ng-template>

<ng-template #views>
    <div class="modal-body">
        <div class="form-group">
            <label>Name:</label>
            <input
                type="text"
                class="form-control"
                [(ngModel)]="view.name"
                placeholder="Enter view's name"
            />
        </div>
        <button class="btn btn-primary pull-right" (click)="saveView()">
            Save
        </button>
    </div>
</ng-template>
