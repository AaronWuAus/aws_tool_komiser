{"ast":null,"code":"import _classCallCheck from \"/Users/mlabouardy/go/src/github.com/mlabouardy/komiser/dashboard/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/mlabouardy/go/src/github.com/mlabouardy/komiser/dashboard/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport 'chartist-plugin-tooltips';\nimport 'jquery-mapael';\nimport 'jquery-mapael/js/maps/world_countries.js';\nimport * as $ from 'jquery';\nimport { AzureService } from '../../azure.service';\nimport { StoreService } from '../../store.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../azure.service\";\nimport * as i2 from \"../../store.service\";\n\nfunction AzureDashboardComponent_h4_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h4\", 16);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    var ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.usedRegions, \" \");\n  }\n}\n\nfunction AzureDashboardComponent_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 19);\n  }\n}\n\nfunction AzureDashboardComponent_h4_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h4\", 16);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    var ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"$ \", ctx_r2.formatNumber(ctx_r2.totalBill), \"\");\n  }\n}\n\nfunction AzureDashboardComponent_div_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 19);\n  }\n}\n\nexport var AzureDashboardComponent = /*#__PURE__*/(function () {\n  var AzureDashboardComponent = /*#__PURE__*/function () {\n    function AzureDashboardComponent(azureService, storeService) {\n      var _this = this;\n\n      _classCallCheck(this, AzureDashboardComponent);\n\n      this.azureService = azureService;\n      this.storeService = storeService;\n      this.totalBill = 0;\n      this.loadingProjects = true;\n      this.loadingUsedRegions = true;\n      this.loadingTotalBill = true;\n      this.regions = new Map([[\"eastus\", {\n        latitude: \"37.3719\",\n        longitude: \"-79.8164\"\n      }], [\"eastus2\", {\n        latitude: \"36.6681\",\n        longitude: \"-78.3889\"\n      }], [\"southcentralus\", {\n        latitude: \"29.4167\",\n        longitude: \"-98.5\"\n      }], [\"westus2\", {\n        latitude: \"47.233\",\n        longitude: \"-119.852\"\n      }], [\"westus3\", {\n        latitude: \"33.448376\",\n        longitude: \"-112.074036\"\n      }], [\"australiaeast\", {\n        latitude: \"-33.86\",\n        longitude: \"151.2094\"\n      }], [\"southeastasia\", {\n        latitude: \"1.283\",\n        longitude: \"103.833\"\n      }], [\"southeastasia\", {\n        latitude: \"1.283\",\n        longitude: \"103.833\"\n      }]\n      /* [\"ams\", { latitude: \"52.370216\", longitude: \"4.895168\" }],\n       [\"sfo\", { latitude: \"37.774929\", longitude: \"-122.419418\" }],\n       [\"sgp\", { latitude: \"1.352083\", longitude: \"103.819839\" }],\n       [\"lon\", { latitude: \"51.507351\", longitude: \"-0.127758\" }],\n       [\"fra\", { latitude: \"50.110924\", longitude: \"8.682127\" }],\n       [\"tor\", { latitude: \"43.653225\", longitude: \"-79.383186\" }],\n       [\"blr\", { latitude: \"12.971599\", longitude: \"77.594566\" }],*/\n      ]);\n      this.initState();\n      this._subscription = this.storeService.profileChanged.subscribe(function (account) {\n        _this.initState();\n      });\n    }\n\n    _createClass(AzureDashboardComponent, [{\n      key: \"ngOnDestroy\",\n      value: function ngOnDestroy() {\n        this._subscription.unsubscribe();\n      }\n    }, {\n      key: \"ngOnInit\",\n      value: function ngOnInit() {}\n    }, {\n      key: \"initState\",\n      value: function initState() {\n        var _this2 = this;\n\n        this.projects = 0;\n        this.usedRegions = 0;\n        this.totalBill = 0;\n        this.loadingProjects = true;\n        this.loadingUsedRegions = true;\n        this.loadingTotalBill = true;\n        this.azureService.getTotalCost().subscribe(function (data) {\n          _this2.totalBill = data.toFixed(2);\n          _this2.loadingTotalBill = false;\n        }, function (err) {\n          _this2.totalBill = 0;\n          _this2.loadingTotalBill = false;\n        });\n        this.azureService.getVMs().subscribe(function (data) {\n          var _usedRegions = new Map();\n\n          var plots = {};\n          var scope = _this2;\n          data.forEach(function (vm) {\n            var region = vm.region.substring(0, vm.region.length - 1);\n            _usedRegions[region] = (_usedRegions[region] ? _usedRegions[region] : 0) + 1;\n          });\n\n          for (var region in _usedRegions) {\n            _this2.usedRegions++;\n            plots[region] = {\n              latitude: scope.regions.get(region).latitude,\n              longitude: scope.regions.get(region).longitude,\n              value: [_usedRegions[region], 1],\n              tooltip: {\n                content: \"\".concat(region, \"<br />VMs: \").concat(_usedRegions[region])\n              }\n            };\n          }\n\n          Array.from(_this2.regions.keys()).forEach(function (region) {\n            var found = false;\n\n            for (var _region in plots) {\n              if (_region == region) {\n                found = true;\n              }\n            }\n\n            if (!found) {\n              plots[region] = {\n                latitude: _this2.regions.get(region).latitude,\n                longitude: _this2.regions.get(region).longitude,\n                value: [_usedRegions[region], 0],\n                tooltip: {\n                  content: \"\".concat(region, \"<br />VMs: 0\")\n                }\n              };\n            }\n          });\n          _this2.loadingUsedRegions = false;\n\n          _this2.showVMsPerRegion(plots);\n        }, function (err) {\n          _this2.loadingUsedRegions = false;\n          _this2.usedRegions = 0;\n        });\n      }\n    }, {\n      key: \"ngAfterViewInit\",\n      value: function ngAfterViewInit() {\n        this.showVMsPerRegion({});\n      }\n    }, {\n      key: \"showVMsPerRegion\",\n      value: function showVMsPerRegion(plots) {\n        var canvas = $(\".mapregions\");\n        canvas.mapael({\n          map: {\n            name: \"world_countries\",\n            zoom: {\n              enabled: true,\n              maxLevel: 10\n            },\n            defaultPlot: {\n              attrs: {\n                fill: \"#004a9b\",\n                opacity: 0.6\n              }\n            },\n            defaultArea: {\n              attrs: {\n                fill: \"#e4e4e4\",\n                stroke: \"#fafafa\"\n              },\n              attrsHover: {\n                fill: \"#FBAD4B\"\n              },\n              text: {\n                attrs: {\n                  fill: \"#505444\"\n                },\n                attrsHover: {\n                  fill: \"#000\"\n                }\n              }\n            }\n          },\n          legend: {\n            plot: [{\n              labelAttrs: {\n                fill: \"#f4f4e8\"\n              },\n              titleAttrs: {\n                fill: \"#f4f4e8\"\n              },\n              cssClass: \"density\",\n              mode: \"horizontal\",\n              title: \"Density\",\n              marginBottomTitle: 5,\n              slices: [{\n                label: \"< 1\",\n                max: \"0\",\n                attrs: {\n                  fill: \"#36A2EB\"\n                },\n                legendSpecificAttrs: {\n                  r: 25\n                }\n              }, {\n                label: \"> 1\",\n                min: \"1\",\n                max: \"50000\",\n                attrs: {\n                  fill: \"#87CB14\"\n                },\n                legendSpecificAttrs: {\n                  r: 25\n                }\n              }]\n            }]\n          },\n          plots: plots\n        });\n      }\n    }]);\n\n    return AzureDashboardComponent;\n  }();\n\n  AzureDashboardComponent.ɵfac = function AzureDashboardComponent_Factory(t) {\n    return new (t || AzureDashboardComponent)(i0.ɵɵdirectiveInject(i1.AzureService), i0.ɵɵdirectiveInject(i2.StoreService));\n  };\n\n  AzureDashboardComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AzureDashboardComponent,\n    selectors: [[\"azure-dashboard\"]],\n    decls: 41,\n    vars: 4,\n    consts: [[1, \"row\"], [1, \"col-md-6\"], [1, \"card\", \"card-stats\"], [1, \"card-body\"], [1, \"col-5\"], [1, \"icon-big\", \"text-center\"], [1, \"la\", \"la-map-marker\"], [1, \"col-7\", \"d-flex\", \"align-items-center\"], [1, \"numbers\"], [1, \"card-category\"], [\"class\", \"card-title\", 4, \"ngIf\"], [\"class\", \"spinner-border spinner-border-sm text-muted\", 4, \"ngIf\"], [1, \"la\", \"la-money\"], [1, \"col-md-12\"], [1, \"card\"], [1, \"card-header\"], [1, \"card-title\"], [1, \"mapregions\"], [1, \"map\"], [1, \"spinner-border\", \"spinner-border-sm\", \"text-muted\"]],\n    template: function AzureDashboardComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"section\");\n        i0.ɵɵelementStart(1, \"div\", 0);\n        i0.ɵɵelementStart(2, \"div\", 1);\n        i0.ɵɵelementStart(3, \"div\", 2);\n        i0.ɵɵelementStart(4, \"div\", 3);\n        i0.ɵɵelementStart(5, \"div\", 0);\n        i0.ɵɵelementStart(6, \"div\", 4);\n        i0.ɵɵelementStart(7, \"div\", 5);\n        i0.ɵɵelement(8, \"i\", 6);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(9, \"div\", 7);\n        i0.ɵɵelementStart(10, \"div\", 8);\n        i0.ɵɵelementStart(11, \"p\", 9);\n        i0.ɵɵtext(12, \"Regions\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(13, AzureDashboardComponent_h4_13_Template, 2, 1, \"h4\", 10);\n        i0.ɵɵtemplate(14, AzureDashboardComponent_div_14_Template, 1, 0, \"div\", 11);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(15, \"div\", 1);\n        i0.ɵɵelementStart(16, \"div\", 2);\n        i0.ɵɵelementStart(17, \"div\", 3);\n        i0.ɵɵelementStart(18, \"div\", 0);\n        i0.ɵɵelementStart(19, \"div\", 4);\n        i0.ɵɵelementStart(20, \"div\", 5);\n        i0.ɵɵelement(21, \"i\", 12);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(22, \"div\", 7);\n        i0.ɵɵelementStart(23, \"div\", 8);\n        i0.ɵɵelementStart(24, \"p\", 9);\n        i0.ɵɵtext(25, \"Bill\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(26, AzureDashboardComponent_h4_26_Template, 2, 1, \"h4\", 10);\n        i0.ɵɵtemplate(27, AzureDashboardComponent_div_27_Template, 1, 0, \"div\", 11);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(28, \"div\", 0);\n        i0.ɵɵelementStart(29, \"div\", 13);\n        i0.ɵɵelementStart(30, \"div\", 14);\n        i0.ɵɵelementStart(31, \"div\", 15);\n        i0.ɵɵelementStart(32, \"h4\", 16);\n        i0.ɵɵtext(33, \"Overview of VMs\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(34, \"p\", 9);\n        i0.ɵɵtext(35, \"Number of VMs by Region\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(36, \"div\", 3);\n        i0.ɵɵelementStart(37, \"div\", 17);\n        i0.ɵɵelementStart(38, \"div\", 18);\n        i0.ɵɵelementStart(39, \"span\");\n        i0.ɵɵtext(40, \"Alternative content for the map\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(13);\n        i0.ɵɵproperty(\"ngIf\", !ctx.loadingUsedRegions);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.loadingUsedRegions);\n        i0.ɵɵadvance(12);\n        i0.ɵɵproperty(\"ngIf\", !ctx.loadingTotalBill);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.loadingTotalBill);\n      }\n    },\n    styles: [\"\"]\n  });\n  return AzureDashboardComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}